con2_res2 = function( C, R, b, c1, c2, w1, w2, m, r, K, h ){
  
  #kc1 <- c(NA, NA, NA, NA)
  #kc2 <- c(NA, NA, NA, NA)
  #kr1 <- c(NA, NA, NA, NA)
  #kr2 <- c(NA, NA, NA, NA)
  
  kc1 <- c(0, 0, 0, 0)
  kc2 <- c(0, 0, 0, 0)
  kr1 <- c(0, 0, 0, 0)
  kr2 <- c(0, 0, 0, 0)
  
  kc1[1] <- C[1]*(b[1]*(c1[1]*w1[1]*R[1] + c1[2]*w1[2]*R[2]) - m[1])*h
  kc2[1] <- C[2]*(b[2]*(c2[1]*w2[1]*R[1] + c2[2]*w2[2]*R[2]) - m[2])*h
  kr1[1] <- R[1]*(r[1]*(1-R[1]/K[1]) - c1[1]*C[1] - c2[1]*C[2])*h
  kr2[1] <- R[2]*(r[2]*(1-R[2]/K[2]) - c1[2]*C[1] - c2[2]*C[2])*h
  
  kc1[2] <- (C[1]+kc1[1]/2)*(b[1]*(c1[1]*w1[1]*(R[1]+kr1[1]/2) + c1[2]*w1[2]*(R[2]+kr2[1]/2)) - m[1])*h
  kc2[2] <- (C[2]+kc2[1]/2)*(b[2]*(c2[1]*w2[1]*(R[1]+kr1[1]/2) + c2[2]*w2[2]*(R[2]+kr2[1]/2)) - m[2])*h
  kr1[2] <- (R[1]+kr1[1]/2)*(r[1]*(1-(R[1]+kr1[1]/2)/K[1]) - c1[1]*(C[1]+kc1[1]/2) - c2[1]*(C[2]+kc2[1]/2))*h
  kr2[2] <- (R[2]+kr2[1]/2)*(r[2]*(1-(R[2]+kr2[1]/2)/K[2]) - c1[2]*(C[1]+kc1[1]/2) - c2[2]*(C[2]+kc2[1]/2))*h
  
  kc1[3] <- (C[1]+kc1[2]/2)*(b[1]*(c1[1]*w1[1]*(R[1]+kr1[2]/2) + c1[2]*w1[2]*(R[2]+kr2[2]/2)) - m[1])*h
  kc2[3] <- (C[2]+kc2[2]/2)*(b[2]*(c2[1]*w2[1]*(R[1]+kr1[2]/2) + c2[2]*w2[2]*(R[2]+kr2[2]/2)) - m[2])*h
  kr1[3] <- (R[1]+kr1[2]/2)*(r[1]*(1-(R[1]+kr1[2]/2)/K[1]) - c1[1]*(C[1]+kc1[2]/2) - c2[1]*(C[2]+kc2[2]/2))*h
  kr2[3] <- (R[2]+kr2[2]/2)*(r[2]*(1-(R[2]+kr2[2]/2)/K[2]) - c1[2]*(C[1]+kc1[2]/2) - c2[2]*(C[2]+kc2[2]/2))*h
  
  kc1[4] <- (C[1]+kc1[3])*(b[1]*(c1[1]*w1[1]*(R[1]+kr1[3]) + c1[2]*w1[2]*(R[2]+kr2[3])) - m[1])*h
  kc2[4] <- (C[2]+kc2[3])*(b[2]*(c2[1]*w2[1]*(R[1]+kr1[3]) + c2[2]*w2[2]*(R[2]+kr2[3])) - m[2])*h
  kr1[4] <- (R[1]+kr1[3])*(r[1]*(1-(R[1]+kr1[3])/K[1]) - c1[1]*(C[1]+kc1[3]) - c2[1]*(C[2]+kc2[3]))*h
  kr2[4] <- (R[2]+kr2[3])*(r[2]*(1-(R[2]+kr2[3])/K[2]) - c1[2]*(C[1]+kc1[3]) - c2[2]*(C[2]+kc2[3]))*h
  
  dC1 <- (kc1[1]+2*kc1[2]+2*kc1[3]+kc1[4])/6
  dC2 <- (kc2[1]+2*kc2[2]+2*kc2[3]+kc2[4])/6
  dR1 <- (kr1[1]+2*kr1[2]+2*kr1[3]+kr1[4])/6
  dR2 <- (kr2[1]+2*kr2[2]+2*kr2[3]+kr2[4])/6
  
  return( c((C[1]+dC1), (C[2]+dC2), (R[1]+dR1), (R[2]+dR2)) )
}
traitDynam = function( C, R, b, c1, c1sum, c2, c2sum, w1, w2, m, r, K, here, sigma, h ){
  
  here1 = here; sigma1 = sigma
  here2 = here; sigma2 = sigma
  
  k1 <- c(0, 0, 0, 0)
  k2 <- c(0, 0, 0, 0)

  k1[1] <- c1[1]*(c1sum - c1[1])*b[1]*( R[1]*w1[1] - w1[2]*R[2] )*h
  k2[1] <- c2[2]*(c2sum - c2[2])*b[2]*( R[2]*w2[2] - w2[1]*R[1] )*h

  k1[2] <- (c1[1]+k1[1]/2)*(c1sum - (c1[1]+k1[1]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] )*h
  k2[2] <- (c2[2]+k2[1]/2)*(c2sum - (c2[2]+k2[1]/2))*b[2]*( R[2]*w2[2] - w2[1]*R[1] )*h
  
  k1[3] <- (c1[1]+k1[2]/2)*(c1sum - (c1[1]+k1[2]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] )*h
  k2[3] <- (c2[2]+k2[2]/2)*(c2sum - (c2[2]+k2[2]/2))*b[2]*( R[2]*w2[2] - w2[1]*R[1] )*h
  
  k1[4] <- (c1[1]+k1[3])*(c1sum - (c1[1]+k1[3]))*b[1]*( R[1]*w1[1] - w1[2]*R[2] )*h
  k2[4] <- (c2[2]+k2[3])*(c2sum - (c2[2]+k2[3]))*b[2]*( R[2]*w2[2] - w2[1]*R[1] )*h
  

  dx1 <- (k1[1]+2*k1[2]+2*k1[3]+k1[4])/6
  dx2 <- (k2[1]+2*k2[2]+2*k2[3]+k2[4])/6
  
  return( c((c1[1]+here1*sigma1*dx1), (c2[2]+here2*sigma2*dx2)) )

  ### c12 fixed ###
  k1[1] <- b[1]*R[1]*w1[1]*h  
  k1[2] <- b[1]*R[1]*w1[1]*h
  k1[3] <- b[1]*R[1]*w1[1]*h
  k1[4] <- b[1]*R[1]*w1[1]*h
  
  ### c12 fixed & preys rapid convergence into eruilibrium ###
  #k1[1] <- (b[1]*K[1]*(-2*c1[1]*C[1] - c2[1]*C[2] + r[1])*w1[1])/r[1]*h
  #k2[1] <- (b[2]*K[2]*(-c1[2]*C[1] - 2*c2[2]*C[2] + r[2])*w2[2])/r[2]*h
  
  #k1[2] <- (b[1]*K[1]*(-2*(c1[1]+k1[1]/2)*C[1] - c2[1]*C[2] + r[1])*w1[1])/r[1]*h
  #k2[2] <- (b[2]*K[2]*(-c1[2]*C[1] - 2*(c2[2]+k2[1]/2)*C[2] + r[2])*w2[2])/r[2]*h
  
  #k1[3] <- (b[1]*K[1]*(-2*(c1[1]+k1[2]/2)*C[1] - c2[1]*C[2] + r[1])*w1[1])/r[1]*h
  #k2[3] <- (b[2]*K[2]*(-c1[2]*C[1] - 2*(c2[2]+k2[2]/2)*C[2] + r[2])*w2[2])/r[2]*h
  
  #k1[4] <- (b[1]*K[1]*(-2*(c1[1]+k1[3])*C[1] - c2[1]*C[2] + r[1])*w1[1])/r[1]*h
  #k2[4] <- (b[2]*K[2]*(-c1[2]*C[1] - 2*(c2[2]+k2[3])*C[2] + r[2])*w2[2])/r[2]*h
  
}

traitDynam01 = function( C, R, b, c1, c1sum, c2, c2sum, w1, w2, m, l, r, K, here, sigma, h ){
  
  here1 = here; sigma1 = sigma
  here2 = here; sigma2 = sigma
  
  k1 <- c(0, 0, 0, 0)
  k2 <- c(0, 0, 0, 0)
  
  c1opt <- 0 #0.11
  
  k1[1] <- (c1[1]-c1opt)*(c1sum - c1[1])*b[1]*( R[1]*w1[1] - w1[2]*R[2] - l )*h
  #k1[1] <- (c1[1]-c1opt)*(c1sum - c1[1])*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 2*l*(c1[1] - c110) )*h
  #k2[1] <- c2[2]*(c2sum - c2[2])*b[2]*( R[2]*w2[2] - w2[1]*R[1] )*h
  
  k1[2] <- ((c1[1]+k1[1]/2)-c1opt)*(c1sum - (c1[1]+k1[1]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - l )*h
  #k1[2] <- ((c1[1]+k1[1]/2)-c1opt)*(c1sum - (c1[1]+k1[1]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 2*l*((c1[1]+k1[1]/2) - c110) )*h
  #k2[2] <- (c2[2]+k2[1]/2)*(c2sum - (c2[2]+k2[1]/2))*b[2]*( R[2]*w2[2] - w2[1]*R[1] )*h
  
  k1[3] <- ((c1[1]+k1[2]/2)-c1opt)*(c1sum - (c1[1]+k1[2]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - l )*h
  #k1[3] <- ((c1[1]+k1[2]/2)-c1opt)*(c1sum - (c1[1]+k1[2]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 2*l*((c1[1]+k1[2]/2) - c110) )*h
  #k2[3] <- (c2[2]+k2[2]/2)*(c2sum - (c2[2]+k2[2]/2))*b[2]*( R[2]*w2[2] - w2[1]*R[1] )*h
  
  k1[4] <- ((c1[1]+k1[3])-c1opt)*(c1sum - (c1[1]+k1[3]))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - l )*h
  #k1[4] <- ((c1[1]+k1[3])-c1opt)*(c1sum - (c1[1]+k1[3]))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 2*l*((c1[1]+k1[3]) - c110) )*h
  #k2[4] <- (c2[2]+k2[3])*(c2sum - (c2[2]+k2[3]))*b[2]*( R[2]*w2[2] - w2[1]*R[1] )*h
  
  
  dx1 <- (k1[1]+2*k1[2]+2*k1[3]+k1[4])/6
  dx2 <- (k2[1]+2*k2[2]+2*k2[3]+k2[4])/6
  
  return( c((c1[1]+here1*sigma1*dx1), (c2[2]+here2*sigma2*dx2)) )
  
}

traitDynam02 = function( C, R, b, c1, c1sum, c2, c2sum, w1, w2, m, l, r, K, here, sigma, h ){
  
  here1 = here; sigma1 = sigma
  here2 = here; sigma2 = sigma
  
  k1 <- c(0, 0, 0, 0)
  k2 <- c(0, 0, 0, 0)
  
  c1opt <- 0 #0.11
  
  k1[1] <- (c1[1]-c1opt)*(c1sum - c1[1])*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 12*(c1[1]-0.1) )*h
  #k1[1] <- (c1[1]-c1opt)*(c1sum - c1[1])*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 270*(c1[1]-c1sum)^2 )*h
  
  k1[2] <- ((c1[1]+k1[1]/2)-c1opt)*(c1sum - (c1[1]+k1[1]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 12*((c1[1]+k1[1]/2)-0.1) )*h
  #k1[2] <- ((c1[1]+k1[1]/2)-c1opt)*(c1sum - (c1[1]+k1[1]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 270*((c1[1]+k1[1]/2)-c1sum)^2 )*h
  
  k1[3] <- ((c1[1]+k1[2]/2)-c1opt)*(c1sum - (c1[1]+k1[2]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 12*((c1[1]+k1[2]/2)-0.1) )*h
  #k1[3] <- ((c1[1]+k1[2]/2)-c1opt)*(c1sum - (c1[1]+k1[2]/2))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 270*((c1[1]+k1[2]/2)-c1sum)^2 )*h
  
  k1[4] <- ((c1[1]+k1[3])-c1opt)*(c1sum - (c1[1]+k1[3]))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 12*((c1[1]+k1[3])-0.1) )*h
  #k1[4] <- ((c1[1]+k1[3])-c1opt)*(c1sum - (c1[1]+k1[3]))*b[1]*( R[1]*w1[1] - w1[2]*R[2] - 270*((c1[1]+k1[3])-c1sum)^2 )*h
  
  dx1 <- (k1[1]+2*k1[2]+2*k1[3]+k1[4])/6
  dx2 <- (k2[1]+2*k2[2]+2*k2[3]+k2[4])/6
  
  return( c((c1[1]+here1*sigma1*dx1), (c2[2]+here2*sigma2*dx2)) )
  
}

traitDynam03 = function( C, R, b, c1, c1sum, c2, c2sum, w1, w2, m, n, r, K, here, sigma, h ){
  
  here1 = here; sigma1 = sigma
  here2 = here; sigma2 = sigma
  
  k1 <- c(0, 0, 0, 0)
  k2 <- c(0, 0, 0, 0)
  
  c1min <- 0.
  c2min <- 0.
  
  k1[1] <- (c1[1]-c1min)*(c1sum - c1[1])*( b[1]*(R[1]*w1[1] - w1[2]*R[2]*(c1sum^n - c1[1]^n)^(1/n-1)*c1[1]^(n-1)) - 12*(c1[1]-0.1) )*h
  k2[1] <- (c2[2]-c2min)*(c2sum - c2[2])*( b[2]*(R[2]*w2[2] - w2[1]*R[1]*(c2sum^n - c2[2]^n)^(1/n-1)*c2[2]^(n-1)) - 12*(c2[2]-0.1) )*h
  
  k1[2] <- ((c1[1]+k1[1]/2)-c1min)*(c1sum - (c1[1]+k1[1]/2))*( b[1]*(R[1]*w1[1] - w1[2]*R[2]*(c1sum^n - (c1[1]+k1[1]/2)^n)^(1/n-1)*(c1[1]+k1[1]/2)^(n-1)) - 12*((c1[1]+k1[1]/2)-0.1) )*h
  k2[2] <- ((c2[2]+k2[1]/2)-c2min)*(c2sum - (c2[2]+k2[1]/2))*( b[2]*(R[2]*w2[2] - w2[1]*R[1]*(c2sum^n - (c2[2]+k2[1]/2)^n)^(1/n-1)*(c2[2]+k2[1]/2)^(n-1)) - 12*((c2[2]+k2[1]/2)-0.1) )*h
  
  k1[3] <- ((c1[1]+k1[2]/2)-c1min)*(c1sum - (c1[1]+k1[2]/2))*( b[1]*(R[1]*w1[1] - w1[2]*R[2]*(c1sum^n - (c1[1]+k1[2]/2)^n)^(1/n-1)*(c1[1]+k1[2]/2)^(n-1)) - 12*((c1[1]+k1[2]/2)-0.1) )*h
  k2[3] <- ((c2[2]+k2[2]/2)-c2min)*(c2sum - (c2[2]+k2[2]/2))*( b[2]*(R[2]*w2[2] - w2[1]*R[1]*(c2sum^n - (c2[2]+k2[1]/2)^n)^(1/n-1)*(c2[2]+k2[1]/2)^(n-1)) - 12*((c2[2]+k2[2]/2)-0.1) )*h
  
  k1[4] <- ((c1[1]+k1[3])-c1min)*(c1sum - (c1[1]+k1[3]))*( b[1]*(R[1]*w1[1] - w1[2]*R[2]*(c1sum^n - (c1[1]+k1[3])^n)^(1/n-1)*(c1[1]+k1[3])^(n-1)) - 12*((c1[1]+k1[3])-0.1) )*h
  k2[4] <- ((c2[2]+k2[3])-c2min)*(c2sum - (c2[2]+k2[3]))*( b[2]*(R[2]*w2[2] - w2[1]*R[1]*(c2sum^n - (c2[2]+k2[3])^n)^(1/n-1)*(c2[2]+k2[3])^(n-1)) - 12*((c2[2]+k2[3])-0.1) )*h
  
  dx1 <- (k1[1]+2*k1[2]+2*k1[3]+k1[4])/6
  dx2 <- (k2[1]+2*k2[2]+2*k2[3]+k2[4])/6
  
  return( c((c1[1]+here1*sigma1*dx1), (c2[2]+here2*sigma2*dx2)) )
  
}
